services:
  mariadb:
    build: docker/mariadb
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: afup
      MYSQL_PASSWORD: afup
      MYSQL_DATABASE: web

  php:
    user: ${CURRENT_USER:-1000}:${CURRENT_GROUP:-1000}
    build:
      context: ./docker/php
      args:
        PHP_VERSION: ${PHP_VERSION:-5.6}
    links:
      - "mariadb:db"
      - "mailcatcher:smtp"
    volumes:
      - .:/app
      - ~/.cache/composer:/tmp/composer
    environment:
      COMPOSER_HOME: /tmp/composer
    depends_on:
      - mariadb
      - yarn
      - mailcatcher

  httpd:
    build:
      context: ./docker/httpd
    volumes:
      - .:/app
    depends_on:
      - "php"

  yarn:
    user: ${FIXUID:-1000}:${FIXGID:-1000}
    build:
      context: ./docker/yarn
    volumes:
      - .:/app
      - ~/.cache/yarn:/home/node/.cache/yarn

  mailcatcher:
    image: schickling/mailcatcher
    ports:
      - "1080:1080"